from sklearn.cluster import MiniBatchKMeans, DBSCAN

# Load and preprocess your real-world client data
df = pd.read_csv('your_client_data.csv')

# Feature selection and preprocessing
features = df[['Net Worth ($)', 'Investable Assets ($)']].fillna(0)
scaler = StandardScaler()
scaler.fit(features)
scaled_data = scaler.transform(features)

# DBSCAN to identify outliers
dbscan = DBSCAN(eps=0.5, min_samples=5)
outliers = dbscan.fit_predict(scaled_data)
outlier_mask = outliers == -1

# Create a plot for DBSCAN clusters
plt.figure(figsize=(8, 6))
plt.scatter(features['Net Worth ($)'], features['Investable Assets ($)'], c=dbscan.labels_, cmap='viridis')
plt.title('DBSCAN Clusters')
plt.show()

# Remove outliers from the dataset
filtered_features = features[~outlier_mask]

# Mini Batch K-Means clustering on filtered data
kmeans = MiniBatchKMeans(n_clusters=3, batch_size=100, random_state=0)
kmeans_clusters = kmeans.fit_predict(filtered_features)

# Add K-Means cluster information to the DataFrame
filtered_features['KMeans_Cluster'] = kmeans_clusters

# Create a plot for K-Means clusters
plt.figure(figsize=(8, 6))
plt.scatter(filtered_features['Net Worth ($)'], filtered_features['Investable Assets ($)'], c=kmeans_clusters, cmap='viridis')
plt.title('K-Means Clusters')
plt.show()

# Determine common clusters between Mini Batch K-Means and DBSCAN
common_clusters = set(kmeans_clusters) & set(dbscan.labels_)

# Identify clients' cluster status based on ensemble clustering
filtered_features['Cluster_Status'] = 'Outlier'
filtered_features.loc[filtered_features.index, 'Cluster_Status'] = 'Not Outlier'
filtered_features.loc[filtered_features['Cluster_Status'] == 'Not Outlier', 'Cluster_Status'] = np.where(
    filtered_features.loc[filtered_features['Cluster_Status'] == 'Not Outlier']['KMeans_Cluster'].isin(common_clusters),
    'Legitimate Cluster',
    'Outlier'
)

# Create a plot for the ensemble clusters
plt.figure(figsize=(8, 6))
plt.scatter(filtered_features['Net Worth ($)'], filtered_features['Investable Assets ($)'],
            c=filtered_features['Cluster_Status'].map({'Legitimate Cluster': 0, 'Outlier': 1}), cmap='viridis')
plt.title('Ensemble Clusters and Outliers')
plt.show()