import streamlit as st
import numpy as np
from sklearn.cluster import FeatureAgglomeration
from scipy.spatial.distance import pdist
from scipy.cluster.hierarchy import linkage, dendrogram
import plotly.graph_objects as go

# Generate sample data (replace with your data)
data = np.random.rand(10, 5)

# Perform Feature Agglomeration
n_clusters = 2
agglomeration = FeatureAgglomeration(n_clusters=n_clusters)
reduced_data = agglomeration.fit_transform(data)

# Calculate dendrogram using linkage and pdist
distances = pdist(reduced_data)
linkage_matrix = linkage(distances, method='ward')

# Create a dendrogram using Plotly
fig = go.Figure()
dendrogram_fig = dendrogram(linkage_matrix, orientation="top")

# Extract the x and y coordinates from the dendrogram
x_coord = dendrogram_fig["icoord"]
y_coord = dendrogram_fig["dcoord"]

# Plot the dendrogram as a series of lines
for x, y in zip(x_coord, y_coord):
    fig.add_trace(go.Scatter(x=x, y=y, mode="lines"))

fig.update_layout(title="Dendrogram")
st.plotly_chart(fig)