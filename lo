import pandas as pd
from openpyxl import load_workbook

# Create a pandas DataFrame (example data)
data1 = {'Column1': [1, 2, 3], 'Column2': ['A', 'B', 'C']}
data2 = {'Column3': [4, 5, 6], 'Column4': ['D', 'E', 'F']}

df1 = pd.DataFrame(data1)
df2 = pd.DataFrame(data2)

# Specify the path to your Excel file
excel_file_path = 'Ratings Change.xlsx'

# Write DataFrames to the Excel file with multiple sheets
with pd.ExcelWriter(excel_file_path, engine='openpyxl') as writer:
    df1.to_excel(writer, sheet_name='Sheet1', index=False)
    df2.to_excel(writer, sheet_name='Sheet2', index=False)

# Open the Excel file and get the workbook
workbook = load_workbook(excel_file_path)

# Iterate through all sheets and autofit columns
for sheet_name in workbook.sheetnames:
    sheet = workbook[sheet_name]
    for col in sheet.columns:
        max_length = 0
        column = col[0].column_letter
        for cell in col:
            try:  # Necessary to avoid error on empty cells
                if len(str(cell.value)) > max_length:
                    max_length = len(cell.value)
            except:
                pass
        adjusted_width = (max_length + 2)
        sheet.column_dimensions[column].width = adjusted_width

# Save the changes
workbook.save(excel_file_path)