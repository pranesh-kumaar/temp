import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.manifold import TSNE
from sklearn.datasets import load_iris  # Replace with your dataset

# Load your dataset (replace 'load_iris()' with your data loading code)
data = load_iris()
X = data.data  # Your feature data

# Perform t-SNE
tsne = TSNE(n_components=2, random_state=42)
tsne_results = tsne.fit_transform(X)

# Create a DataFrame combining t-SNE results and original features
tsne_df = pd.DataFrame(data=tsne_results, columns=['t-SNE Dimension 1', 't-SNE Dimension 2'])
original_df = pd.DataFrame(data=X, columns=data.feature_names)
combined_df = pd.concat([tsne_df, original_df], axis=1)

# Calculate the correlation matrix
correlation_matrix = combined_df.corr()

# Create a heatmap
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', linewidths=0.5)
plt.title('Correlation Heatmap between t-SNE Dimensions and Features')
plt.savefig('tsne_correlation_heatmap.png')  # Save the heatmap as an image
plt.show()

# Save the correlation matrix to an Excel file
correlation_matrix.to_excel('tsne_correlation_matrix.xlsx', index=False)